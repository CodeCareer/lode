!function(){"use strict";angular.module("kt.lode").controller("ktAnalyticsCtrl",["$scope","$rootScope","$state","$stateParams","ktProjectsService","user",function(a,b,c,d,e,f){function g(b){return _.find(a.projects||[],{id:"all"!==b.id?parseInt(b.id,10):"all"})}function h(){var b=g({id:a.projectID});return b?b.name:"全部项目"}function i(b){var c=g(b);c?($.extend(c,b),a.activeProjectName=data.name):a.projects.push(b)}function j(){var b=_.find(c.$current.path,function(a){return"analytics.project"===a.name});b&&(b.data.pageTitle=a.activeProjectName)}a.projectID="all",b.user=f,a.breadcrumbFilter=function(a){return a.data.breadcrumb},a.isAllProjectsPage=function(){return c.includes("analytics.projects.**")||c.includes("analytics.reports.**")||c.includes("analytics.institutions.**")},b.stateGo=a.stateGo=function(b,d,e){d&&a[d](e),c.go(b)},e.get(function(c){c.projects.unshift({id:"all",name:"全部项目"}),b.projects=a.projects=c.projects,a.activeProjectName=h(),j()}),a.$on("activeProjectChange",function(b,c){a.projectID!==c.projectID&&(a.projectID=c.projectID||"all",a.activeProjectName=h(),j())}),a.$on("activeProjectUpdate",function(a,b){i(b)}),a.summaryMenu={reportsIsCollapsed:!c.includes("analytics.reports.**"),projectsIsCollapsed:!c.includes("analytics.projects.**"),institutionsIsCollapsed:!c.includes("analytics.institutions.**")},a.menu={dashboardIsCollapsed:!c.includes("analytics.project.dashboard.**"),debtorsIsCollapsed:!c.includes("analytics.project.debtors.**"),assetPerformanceIsCollapsed:!c.includes("analytics.project.asset.**"),riskIsCollapsed:!c.includes("analytics.project.risk.**"),settingsIsCollapsed:!c.includes("analytics.project.settings.**")},a.currStateSwitch=function(a){if("all"===a)return void c.go(b.defaultRoute);var d,e;d=c.includes("analytics.project.**")?c.current.name:"analytics.project.dashboard",e={projectID:a},c.go(d,e)},b.$on("$stateChangeSuccess",function(c,d){d.name===b.defaultRoute&&(a.summaryMenu.reportsIsCollapsed=!1)}),a.updateSummaryMenu=function(b){_.each(a.summaryMenu,function(c,d){d!==b&&(a.summaryMenu[d]=!0)}),a.summaryMenu[b]=!a.summaryMenu[b]},a.updateMenu=function(b){_.each(a.menu,function(c,d){d!==b&&(a.menu[d]=!0)}),a.menu[b]=!a.menu[b]},b.$on("$stateChangeSuccess",function(){$(window).scrollTop(0)})}])}();