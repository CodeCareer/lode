!function(){"use strict";angular.module("kt.lode").controller("ktAssetFeatureCtrl",["$scope","$stateParams","ktStaticsReportService","ktInstitutionsService","ktDateHelper",function(a,b,c,d,e){function f(b){var c={timelimitsChart:["prncp_balns_by_term","incre_loan_amnt_by_term"],amountsChart:["prncp_balns_by_amnt","incre_loan_amnt_by_amnt"],educationsChart:["prncp_balns_by_education","incre_loan_amnt_by_education"],agesChart:["prncp_balns_by_age","prncp_balns_by_age_percent"]},d=c[b],e=d[0],f="";return"locationChart"===b&&(f=f+"_"+a.locationChart.topDimension.toLowerCase()),i="_percent"===f?{tooltip:{yAxisFormat:"percent"},yAxis:{interval:.2,max:1,min:0}}:{tooltip:{yAxisFormat:"rmb"},yAxis:{interval:null,max:null}},e+f}function g(b){var c=a.data,d=f(b);a[b].list=c[d],a[b].chartOptions=$.extend(!0,{},i,{legend:{data:_.map(c[d],"name")},xAxis:{type:"category",data:c.dates},series:_.map(c[d],function(a){return a.type="bar",a.stack="堆积组",a.barWidth=40,a})})}function h(b){var d,f,h;h=e.getDate(a.radioPeriod)||a.radioPeriodCustom,h=h.split("~"),d=h[0]||null,f=h[1],a.activeInstID=b||"all",a.pendingRequests=!0,c.get({type:"assets_features",inst_id:b,start_date:d,end_date:f},function(b){a.data=b,g("timelimitsChart"),g("amountsChart"),g("educationsChart"),g("agesChart"),a.pendingRequests=!1})}a.$emit("activeProjectChange",{projectID:b.projectID}),a.radioPeriod="all",a.radioPeriodCustom="custom",a.institutions=[],a.insitutionChange=function(b,c){a.institutionName=c,h(b)},d.get(function(b){b.institutions.unshift({id:"all",name:"全部机构"}),a.institutions=b.institutions,a.institutionName=a.institutions[0].name}),a.radioDataShowType="chart",a.timelimitsChart={chartOptions:{},menuData:{index:0},list:[]},a.amountsChart={chartOptions:{},menuData:{index:0},list:[]},a.agesChart={chartOptions:{},menuData:{index:0},list:[]},a.educationsChart={chartOptions:{},menuData:{index:0},list:[]},a.$watch("radioPeriod",function(b,c){b!==c&&"custom"!==b&&h(a.activeInstID)});var i={tooltip:{yAxisFormat:"rmb"}};h()}])}();