!function(){"use strict";angular.module("kt.lode").controller("ktAssetFeatureCtrl",["$scope","ktStaticsReportService","ktInstitutionsService","ktDateHelper",function(a,b,c,d){function e(b){var c={timelimitsChart:["prncp_balns_by_term","incre_loan_amnt_by_term"],amountsChart:["prncp_balns_by_amnt","incre_loan_amnt_by_amnt"],educationsChart:["prncp_balns_by_education","incre_loan_amnt_by_education"],agesChart:["prncp_balns_by_age","prncp_balns_by_age_percent"]},d=c[b],e=d[0],f="";return"locationChart"===b&&(f=f+"_"+a.locationChart.topDimension.toLowerCase()),h="_percent"===f?{tooltip:{yAxisFormat:"percent"},yAxis:{interval:.2,max:1,min:0}}:{tooltip:{yAxisFormat:"rmb"},yAxis:{interval:null,max:null}},e+f}function f(b){var c=a.data,d=e(b);a[b].list=c[d],a[b].chartOptions=$.extend(!0,{},h,{legend:{data:_.map(c[d],"name")},xAxis:{type:"category",data:c.dates},series:_.map(c[d],function(a){return a.type="bar",a.stack="堆积组",a.barWidth=40,a})})}function g(c){var e,g,h;h=d.getDate(a.radioPeriod)||a.radioPeriodCustom,h=h.split("~"),e=h[0]||null,g=h[1],a.activeInstID=c||"all",a.pendingRequests=!0,b.get({type:"assets_features",inst_id:c,start_date:e,end_date:g},function(b){a.data=b,f("timelimitsChart"),f("amountsChart"),f("educationsChart"),f("agesChart"),a.pendingRequests=!1})}a.radioPeriod="all",a.radioPeriodCustom="custom",a.institutions=[],a.insitutionChange=function(b,c){a.institutionName=c,g(b)},c.get(function(b){b.institutions.unshift({id:"all",name:"全部机构"}),a.institutions=b.institutions,a.institutionName=a.institutions[0].name}),a.radioDataShowType="chart",a.timelimitsChart={chartOptions:{},menuData:{index:0},list:[]},a.amountsChart={chartOptions:{},menuData:{index:0},list:[]},a.agesChart={chartOptions:{},menuData:{index:0},list:[]},a.educationsChart={chartOptions:{},menuData:{index:0},list:[]},a.$watch("radioPeriod",function(b,c){b!==c&&"custom"!==b&&g(a.activeInstID)});var h={tooltip:{yAxisFormat:"rmb"}};g()}])}();