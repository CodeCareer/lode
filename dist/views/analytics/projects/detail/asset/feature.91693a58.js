!function(){"use strict";angular.module("kt.lode").controller("ktAssetFeatureLayoutCtrl",["$scope","$state","$stateParams","$location","ktProjectsService","ktDateHelper",function(a,b,c,d,e,f){a.shared={},a.shared.params=$.extend({filter:""},d.search()||{}),a.dateOptions={field:"date",field_type:"date",name:"期限",options:[{name:"上月",value:f.getDate("lastMonth")},{name:"近三月",value:f.getDate("last3Month")},{name:"近六个月",value:f.getDate("last6Month")},{name:"自定义",type:"datepicker",onUpdate:function(c){this.name=this.value=c,b.go(b.current.name,{filter:$.param($.extend({},a.shared.fParams,{date:c}))})},value:""}],perform_type:"options",option_type:"object",no_discretized:!0,unit:""},a.shared.filters=[{field:"risk_index",field_type:"string",name:"指标",options:[{name:"时点余额",value:"prncp_balns"},{name:"新增成交",value:"amnt_incrmnt"}],perform_type:"options",option_type:"object",no_discretized:!0,unit:""},a.dateOptions],a.shared.filters.hideFParams=!0,a.shared.filters.cannotDelete=!0}]).controller("ktAssetFeatureCtrl",["$scope","$rootScope","$location","$stateParams","ktProjectsService","ktProjectStaticsReportService","ktDataHelper","ktDateHelper",function(a,b,c,d,e,f,g,h){function i(){var b=a.data,c=b.dimensions;_.each(c,function(c){var d=_.find(a.charts,function(a){return a.key===c.key});d||(d={key:c.key,name:c.name,description:c.description,radioDataShowType:"table",chartDimension:"amnt_incrmnt"===a.shared.fParams.risk_index?"新增成交":"时点余额",chartOptions:{},list:[],menuData:{index:0,value:"absolute"},menuDataChange:function(){this.updateData()},dimentionChange:function(a){this.chartDimension=a,this.updateData()},updateData:function(){var d,e,f;d="时点余额"===this.chartDimension?"prncp_balns_by_":"loan_amnt_incrmnt_by_",e="absolute"===this.menuData.value?"":"_percent",f=d+this.key+e;var g="_percent"===e?{tooltip:{yAxisFormat:"percent"},yAxis:{max:1,min:0,name:"百分比(%)"}}:{toolbox:{show:!0,feature:{saveAsImage:{name:a.activeProjectName+"-"+c.name+"-"+moment().format("YYYY年MM月DD日HH时mm分ss秒")}},x:"right",y:"6%"},tooltip:{yAxisFormat:"rmb"},yAxis:{max:null}};this.list=b[f],this.chartOptions=$.extend(!0,{},g,{legend:{data:_.map(b[f],"name")},xAxis:{type:"category",data:b.dates},series:_.map(b[f],function(a){return a.type="bar",a.stack="堆积组",a.barWidth=40,a})})}},d.updateData(),a.charts.push(d))})}function j(){var b=_.cloneDeep(a.shared.fParams),c=b.date.split("~");b.start_date=c[0],b.end_date=c[1],delete b.date,f.get($.extend({projectID:d.projectID,type:"loan",dimention:"distribution"},b),function(b){a.data=b,i()})}var k=c.search(),l=a.shared.params,m=a.shared.filters;$.extend(l,k),g.pruneDirtyParams(l,k,["filter"]),a.shared.fParams=$.extend({risk_index:"prncp_balns",date:h.getDate("last6Month")},g.cutDirtyParams(g.decodeParams(l,["filter"])));var n=_.find(a.dateOptions.options,function(b){return a.dateOptions.options[3].value="",a.shared.fParams.date===b.value});if(!n){var o=_.last(a.dateOptions.options);o.value=o.name=a.shared.fParams.date}a.shared.updateFilterFParams?(g.filterInit(m)(a.shared.fParams),a.shared.updateFilterFParams()):b.$on("filterInitDone",function(){g.filterInit(m)(a.shared.fParams),a.shared.updateFilterFParams()}),a.charts=[],j()}])}();