!function(){"use strict";angular.module("kt.lode").controller("ktAssetRiskLayoutCtrl",["$scope","$state","$stateParams","$location","ktProjectsService","ktDateHelper",function(a,b,c,d,e,f){a.shared={},a.shared.params=$.extend({filter:""},d.search()||{}),a.dateOptions={field:"date",field_type:"date",name:"期限",options:[{name:"上月",value:f.getDate("lastMonth")},{name:"近三月",value:f.getDate("last3Month")},{name:"近六个月",value:f.getDate("last6Month")},{name:"自定义",type:"datepicker",onUpdate:function(c){this.name=this.value=c,b.go(b.current.name,{filter:$.param($.extend({},a.shared.fParams,{date:c}))})},value:""}],perform_type:"options",option_type:"object",no_discretized:!0,unit:""},a.shared.filters=[{field:"dimension",field_type:"string",name:"维度",options:[],perform_type:"options",option_type:"object",no_discretized:!0,unit:""},{field:"risk_index",field_type:"string",name:"指标",options:[{name:"C-M1",value:"C-M1"},{name:"M1-C",value:"M1-C"},{name:"逾期率",value:"ovd_rate"},{name:"不良率",value:"np_rate"}],perform_type:"options",option_type:"object",no_discretized:!0,unit:""},a.dateOptions],a.shared.filters.cannotDelete=!0,e.get($.extend({projectID:c.projectID,subContent:"discretized_dimensions"},params),function(b){var c=_.find(a.shared.filters,{field:"dimension"});c.options=_.map(b.dimensions,function(a){return{name:a.name,value:a.key,description:a.description}}),a.$broadcast("filterReady")})}]).controller("ktAssetRiskCtrl",["$scope","$timeout","$rootScope","$location","$stateParams","ktProjectsService","ktProjectStaticsReportService","ktDataHelper","ktDateHelper",function(a,b,c,d,e,f,g,h,i){function j(){var b=_.cloneDeep(a.shared.fParams),c=b.date.split("~");b.start_date=c[0],b.end_date=c[1],delete b.date,g.get($.extend({projectID:e.projectID,type:"asset",dimention:"risk"},b),function(b){a.data=b,a.assetRiskChart.chartOptions=$.extend(!0,{},p,{legend:{data:_.map(b.trends,"name")},xAxis:{type:"category",data:b.dates},yAxis:{name:"百分比(%)"},series:_.map(b.trends,function(a){return a.type="line",a})})})}var k=d.search(),l=a.shared.params,m=a.shared.filters;$.extend(l,k),h.pruneDirtyParams(l,k,["filter"]),a.$on("filterReady",function(){if(!a.shared.fParams.dimension){var b=_.find(m,function(a){return"dimension"===a.field});a.shared.fParams.dimension=b.options[0].value}}),a.shared.fParams=$.extend({dimension:function(){var a=_.find(m,function(a){return"dimension"===a.field}).options[0]||{};return a.value||null}(),risk_index:"ovd_rate",date:i.getDate("last6Month")},h.cutDirtyParams(h.decodeParams(l,["filter"]))),a.riskIndexName=function(){return a.shared.filterFParams?_.find(a.shared.filterFParams,{value:"risk_index"}).name:""},a.dimensionName=function(){return a.shared.filterFParams?_.find(a.shared.filterFParams,{value:"dimension"}).name:""};var n=_.find(a.dateOptions.options,function(b){return a.shared.fParams.date===b.value});if(!n){var o=_.last(a.dateOptions.options);o.value=o.name=a.shared.fParams.date}a.shared.updateFilterFParams?(h.filterInit(m)(a.shared.fParams),a.shared.updateFilterFParams()):b(function(){h.filterInit(m)(a.shared.fParams),a.shared.updateFilterFParams()},1e3),a.assetRiskChart={radioDataShowType:"chart",chartOptions:{}};var p={tooltip:{axisPointer:{type:"line"},yAxisFormat:"percent"}};j()}])}();