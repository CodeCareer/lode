!function(){"use strict";angular.module("kt.lode").controller("ktVintageCtrl",["$scope","$location","$stateParams","ktProjectStaticsReportService","ktDateHelper",function(a,b,c,d,e){function f(){var b,e,f;f=a.radioPeriod,f=f.split("~"),b=f[0],e=f[1],d.get($.extend({projectID:c.projectID,type:"vintages",dimention:"risk",start_date:b,end_date:e},g),function(b){a.data=b,a.vintageChart.chartOptions=$.extend(!0,{},h,{legend:{data:_.map(b.trends,"name")},xAxis:{type:"category",data:b.dates},series:_.map(b.trends,function(a){return a.type="line",a})})})}a.$emit("activeProjectChange",{projectID:c.projectID});var g=a.params=$.extend({vintage_index:"ovd_rate",vintage_start_date:moment().date(1).subtract(6,"months").format("YYYY-MM-DD"),vintage_end_date:moment().date(0).format("YYYY-MM-DD")},b.search()||{});a.vintage_indexs=[{name:"C-M1",value:"c_m1_rate"},{name:"M1-C",value:"m1_c_rate"},{name:"M1-M2",value:"m1_m2_rate"},{name:"逾期率",value:"ovd_rate"},{name:"不良率",value:"np_rate"}],a.vintageRange=function(){return g.vintage_start_date?g.vintage_start_date+"~"+g.vintage_end_date:void 0}(),a.vintage_indexs.activeName=function(){var b=_.find(a.vintage_indexs,function(a){return a.value===g.vintage_index})||a.vintage_indexs[0];return b.name},e.initPeriod(a,g),a.data={},a.$watch("radioPeriod",function(a,c){if(a!==c&&"custom"!==a){var d=a.split("~");b.search($.extend(g,{start_date:d[0]||null,end_date:d[1]||null}))}}),a.$watch("vintageRange",function(a,c){if(a!==c){var d=a.split("~");b.search($.extend(g,{vintage_start_date:d[0]||null,vintage_end_date:d[1]||null}))}}),a.goTo=function(a,c){var d={};d[a]=c,b.search($.extend(g,d))},a.vintageChart={radioDataShowType:"table",chartOptions:{}};var h={tooltip:{axisPointer:{type:"line"},yAxisFormat:"percent"}};f()}])}();