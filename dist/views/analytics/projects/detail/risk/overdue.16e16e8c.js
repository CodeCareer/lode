!function(){"use strict";angular.module("kt.lode").controller("ktOverdueLayoutCtrl",["$scope","$state","$stateParams","$location","ktProjectsService","ktDateHelper",function(a,b,c,d,e,f){a.shared={},a.shared.params=$.extend({filter:""},d.search()||{}),a.dateOptions={field:"date",field_type:"date",name:"期限",options:[{name:"上月",value:f.getDate("lastMonth")},{name:"近三月",value:f.getDate("last3Month")},{name:"近六个月",value:f.getDate("last6Month")},{name:"自定义",type:"datepicker",onUpdate:function(c){this.name=this.value=c,b.go(b.current.name,{filter:$.param($.extend({},a.shared.fParams,{date:c}))})},value:""}],perform_type:"options",option_type:"object",no_discretized:!0,unit:""},a.shared.filters=[a.dateOptions],a.shared.filters.hideFParams=!0,a.shared.filters.cannotDelete=!0}]).controller("ktOverdueCtrl",["$scope","$rootScope","$location","$stateParams","ktProjectsService","ktProjectStaticsReportService","ktDataHelper","ktDateHelper",function(a,b,c,d,e,f,g,h){function i(){var b=_.cloneDeep(a.shared.fParams),c=b.date.split("~");b.start_date=c[0],b.end_date=c[1],delete b.date,f.get($.extend({projectID:d.projectID,type:"trends",dimention:"risk"},b),function(b){a.data=b,a.overdueRateChart.chartOptions=$.extend(!0,{},o,{legend:{data:_.map(b.overdue_trends.reverse().filter(function(a){return!_.includes(["逾期率","不良率"],a.name)}),"name")},xAxis:{type:"category",data:b.dates},series:_.map(b.overdue_trends.reverse().filter(function(a){return!_.includes(["逾期率","不良率"],a.name)}),function(a){return a.type="line",a.stack="stack",a.smooth=!0,a.itemStyle={normal:{areaStyle:{type:"default"}}},a})}),a.migrateRateChart.legend=_.chain(b.migration_trends).map(function(a){return{name:a.name,value:!0}}).value(),a.migrateRateChart.chartOptions=$.extend(!0,{},o,{legend:{data:_.map(b.migration_trends,"name")},xAxis:{type:"category",data:b.dates},series:_.map(b.migration_trends,function(a){return a.type="line",a})})})}var j=c.search(),k=a.shared.params,l=a.shared.filters;$.extend(k,j),g.pruneDirtyParams(k,j,["filter"]),a.shared.fParams=$.extend({date:h.getDate("last6Month")},g.cutDirtyParams(g.decodeParams(k,["filter"])));var m=_.find(a.dateOptions.options,function(b){return a.shared.fParams.date===b.value});if(!m){var n=_.last(a.dateOptions.options);n.value=n.name=a.shared.fParams.date}a.shared.updateFilterFParams?(g.filterInit(l)(a.shared.fParams),a.shared.updateFilterFParams()):b.$on("filterInitDone",function(){g.filterInit(l)(a.shared.fParams),a.shared.updateFilterFParams()}),a.overdueRateChart={overdueTab:!0,badTab:!0,radioDataShowType:"table",chartOptions:{}},a.migrateRateChart={legend:[],radioDataShowType:"table",chartDimension:"逾期率",chartOptions:{}};var o={tooltip:{axisPointer:{type:"line"},yAxisFormat:"percent"}};i()}])}();