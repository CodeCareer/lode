!function(){"use strict";angular.module("kt.lode").filter("filterByFormat",["$filter",function(a){return function(b,c){var d=b;switch(c){case"date":d=a("date")(b,"yyyy-MM-dd");break;case"percent":d=a("ktNumber")(b,2,"percent");break;case"currency":d=a("ktNumberLocate")(b);break;default:d=b||"-"}return d}}]).controller("ktDebtorCtrl",["$scope","$location","$state","$stateParams","ktProjectsService",function(a,b,c,d,e){a.shared={},a.shared.filters=[],a.shared.filterFParams=[];var f=a.shared.params={page:1,per_page:10},g=a.shared._params={maxSize:10,totalItems:10};a.beginSearch=function(b,c){a.goTo(b,c,"search")},a.goTo=function(b,d,e){var f={},g="discretized_"+b,h="from_"+b,i="to_"+b,j="custom_for_show_"+b;if(b)if("custom"===e){if(!a.shared.filters.validateByField(b))return;var k=d.split("-"),l=a.shared.filters.getByField(b);delete a.shared.fParams[g],f[h]=k[0]||null,f[i]=k[1]||null,f[j]=d+l.unit}else if("search"===e){if(!a.shared.filters.validateByField(b))return;f[b]=d}else delete a.shared.fParams[h],delete a.shared.fParams[i],delete a.shared.fParams[j],f[g]=d;c.go(c.current.name,{filter:$.param($.extend({},a.shared.fParams,f))})},a.delFParams=function(b){var c=a.shared.fParams;if(delete c[b],b.indexOf("custom_for_show_")>-1){var d=b.replace("custom_for_show_","");delete c["from_"+d],delete c["to_"+d]}a.goTo()},a.resetFParams=function(){a.shared.fParams={},a.shared.filterFParams=[],a.goTo()},a.getFParamsLength=function(){return _.keys(a.shared.fParams).length},e.get($.extend({},g,f,{subContent:"filters",projectID:d.projectID}),function(b){a.shared.filters=b.filters,a.$broadcast("filtersReady")})}]).controller("ktDebtorTableCtrl",["$scope","$location","$stateParams","ktProjectsService","ktDataHelper",function(a,b,c,d,e){function f(){var b=_.map(a.shared.filters,"field"),c=_.pickBy(a.shared.fParams,function(a,b){return!b.startsWith("from_")&&!b.startsWith("to_")});c=_.map(c,function(a,c){return{index:_.indexOf(b,c.replace(/custom_for_show_|discretized_/g,"")),value:c,name:a}}),a.shared.filterFParams=c.sort(function(a,b){return a.index>b.index?1:a.index<b.index?-1:0})}var g=b.search(),h=a.shared.params,i=a.shared._params,j=a.shared.filters;$.extend(h,g),e.pruneDirtyParams(h,g,["filter"]);var k=a.shared.fParams=e.cutDirtyParams(e.decodeParams(h,["filter"]));j.length?(e.filterInit(j)(k),f()):a.$on("filtersReady",function(){e.filterInit(a.shared.filters)(k),f()}),a.getFormat=function(b){return a.fields[b].format},d.get($.extend({subContent:"borrowers",projectID:c.projectID},h,k),function(c){a.borrowers=c.borrowers,a.fields=c.fields,i.totalItems=c.total_items,a.shared.pageChanged=function(){b.search("page",h.page)}})}])}();