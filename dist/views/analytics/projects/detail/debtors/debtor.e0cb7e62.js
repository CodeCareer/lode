!function(){"use strict";angular.module("kt.lode").filter("filterByFormat",["$filter",function(a){return function(b,c){var d=b;switch(c){case"date":d=a("date")(b,"yyyy-MM-dd");break;case"percent":d=a("ktNumber")(b,2,"percent");break;case"currency":d=a("ktNumberLocate")(b);break;default:d=b||"-"}return d}}]).controller("ktDebtorCtrl",["$scope","$location","$state","$stateParams","ktProjectsService",function(a,b,c,d,e){a.$emit("activeProjectChange",{projectID:d.projectID}),a.shared={},a.shared.filters=[],a.shared.search_filters=[];var f=a.shared.params={page:1,per_page:10},g=a.shared._params={maxSize:10,totalItems:10};a.shared.filterFParams=function(){return _.pickBy(a.shared.fParams,function(a,b){return!b.startsWith("from_")&&!b.startsWith("to_")})},a.beginSearch=function(b,c){a.goTo(b,c,"search")},a.goTo=function(b,d,e){var f={},g="discretized_"+b,h="from_"+b,i="to_"+b,j="custom_for_show_"+b;if(b)if("custom"===e){if(!a.shared.filters.validateByField(b))return;var k=d.split("-"),l=a.shared.filters.getByField(b);delete a.shared.fParams[g],f[h]=k[0]||null,f[i]=k[1]||null,f[j]=d+l.unit}else if("search"===e){if(!a.shared.filters.validateByField(b))return;f[b]=d}else delete a.shared.fParams[h],delete a.shared.fParams[i],delete a.shared.fParams[j],f[g]=d;c.go(c.current.name,{filter:$.param($.extend({},a.shared.fParams,f))})},a.delFParams=function(b){var c=a.shared.fParams;if(delete c[b],b.indexOf("custom_for_show_")>-1){var d=b.split("_")[3];delete c["from_"+d],delete c["to_"+d]}a.goTo()},a.getFParamsLength=function(){return _.keys(a.shared.fParams).length},e.get($.extend({},g,f,{subContent:"filters",projectID:d.projectID}),function(b){a.shared.filters=b.filters,a.$broadcast("filtersReady")})}]).controller("ktDebtorTableCtrl",["$scope","$location","$stateParams","ktProjectsService","ktDataHelper",function(a,b,c,d,e){var f=b.search(),g=a.shared.params,h=a.shared._params,i=a.shared.filters;$.extend(g,f),e.pruneDirtyParams(g,f,["filter"]);var j=a.shared.fParams=e.cutDirtyParams(e.decodeParams(g,["filter"]));i.length?e.filterInit(i)(j):a.$on("filtersReady",function(){e.filterInit(a.shared.filters)(j)}),a.getFormat=function(b){return a.fields[b].format},d.get($.extend({subContent:"borrowers",projectID:c.projectID},g,j),function(c){a.borrowers=c.borrowers,a.fields=c.fields,h.totalItems=c.total_items,a.shared.pageChanged=function(){b.search("page",g.page)}})}])}();