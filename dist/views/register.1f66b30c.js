!function(){"use strict";angular.module("kt.lode").controller("ktRegisterCtrl",["$scope","$rootScope","$stateParams","$timeout","$state","ktUserService","ktSweetAlert","ktCaptchaService",function(a,b,c,d,e,f,g,h){a.registerUser={},a.registerUser.type=c.type||"fund",a.submitForm=function(){return a.pendingRequests=!0,f.save(a.registerUser).$promise.then(function(c){a.pendingRequests=!1,c.success?g.swal({title:"提交成功",text:"感谢您的申请，我们的业务人员会尽快与您联系，以进行线下机构认证。",type:"success"},function(){e.go(b.previousState||"home.index")}):g.swal({title:"提交失败",text:c.error||"抱歉，您的信息没有提交成功，请再次尝试！",type:"error"})},function(b){a.pendingRequests=!1,g.swal({title:"提交失败",text:$.isArray(b.error)?b.error.join("<br/>"):b.error||"抱歉，您的信息没有提交成功，请再次尝试！",type:"error"})}),!1},a.waitCaptchaMessage=!1,a.waitCaptchaTel=!1,a.captchaSettings={};var i=ktCaptchaHelper.timerMessage(a),j=ktCaptchaHelper.timerTel(a);a.getCaptcha=function(b,c){b.preventDefault(),b.stopPropagation();var e=a.captchaSettings.CAPTCHA;return e?void e.validate(a.registerUser.img_captcha,function(b){if(b){if("sms"===c&&a.waitCaptchaMessage)return;if("tel"===c&&a.waitCaptchaTel)return;h.get({mobile:a.registerUser.mobile,channel:c},function(b){0===b.status_code?(a.registerUser.verif_id=b.verif_id,"sms"===c?(a.waitCaptchaMessage=!0,i(60)):(a.waitCaptchaTel=!0,j(60))):g.swal({title:"发送失败",text:b.msg||"抱歉，系统繁忙！",type:"error"})},function(a){g.swal({title:"发送失败",text:a.msg||"抱歉，系统繁忙！",type:"error"})})}else d(function(){g.swal({title:"提示",text:"图形验证码不正确！",type:"error"},function(){var b=e._container.closest("form");b.trigger("accessible."+b.attr("id"),{field:"img_captcha"}),a.registerUser.img_captcha=""})},100)}):void g.swal({title:"验证码组件有误",text:"验证码组件有误！",type:"error"})}}])}();